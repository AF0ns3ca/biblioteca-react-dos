import{j as e,r as w,Y as J}from"./app-BWqVOTto.js";import{A as K}from"./AuthenticatedLayout-DprPw_-f.js";import{d as S}from"./index-DSZIrT3Y.js";import{d as W,A as X}from"./AddToLibraryModal-BsZH22I3.js";import{a as Y,i as E,r as Z}from"./Footer-D_spoCkC.js";import{B as k,C as ee}from"./BookStatusSelector-XASypFy7.js";import{B as I}from"./BasicRating-B3j7gYUl.js";import{u as se}from"./useMediaQuery-oiCnNeU-.js";import{B as te}from"./Box-oW4veK2X.js";import{T as ae,a as R}from"./Tab-Bpnm4Yl1.js";import"./index-gq_3ibrm.js";import"./transition-CsO0oszz.js";import"./LocalLibraryOutlined-D2U8jrKi.js";import"./ButtonBase-DEJAB0Cn.js";var L={},le=E;Object.defineProperty(L,"__esModule",{value:!0});var z=L.default=void 0,re=le(Y()),ie=e;z=L.default=(0,re.default)((0,ie.jsx)("path",{d:"M17 11v6.97l-5-2.14-5 2.14V5h6V3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V11zm4-4h-6V5h6z"}),"BookmarkRemoveOutlined");var A={},ne=E;Object.defineProperty(A,"__esModule",{value:!0});var q=A.default=void 0,ce=ne(Y()),de=e;q=A.default=(0,ce.default)((0,de.jsx)("path",{d:"m18.85 10.39 1.06-1.06c.78-.78.78-2.05 0-2.83L18.5 5.09c-.78-.78-2.05-.78-2.83 0l-1.06 1.06zm-4.24 1.42L7.41 19H6v-1.41l7.19-7.19zm-1.42-4.25L4 16.76V21h4.24l9.19-9.19zM19 17.5c0 2.19-2.54 3.5-5 3.5-.55 0-1-.45-1-1s.45-1 1-1c1.54 0 3-.73 3-1.5 0-.47-.48-.87-1.23-1.2l1.48-1.48c1.07.63 1.75 1.47 1.75 2.68M4.58 13.35C3.61 12.79 3 12.06 3 11c0-1.8 1.89-2.63 3.56-3.36C7.59 7.18 9 6.56 9 6c0-.41-.78-1-2-1-1.26 0-1.8.61-1.83.64-.35.41-.98.46-1.4.12-.41-.34-.49-.95-.15-1.38C3.73 4.24 4.76 3 7 3s4 1.32 4 3c0 1.87-1.93 2.72-3.64 3.47C6.42 9.88 5 10.5 5 11c0 .31.43.6 1.07.86z"}),"DrawOutlined");const M=({book:s,auth:r,librariesWithBookCount:N})=>{const[h,f]=w.useState(!1),[p,c]=w.useState(!1),[i,m]=w.useState(""),v=async()=>{let o="Ya no quieres leer este libro?";s.status==="leyendo"?o="¿Seguro que quieres cancelar tu lectura?":s.status==="leido"&&(o="¿Seguro que quieres eliminar tu registro de lectura?"),window.confirm(o)&&await S.Inertia.delete("/deletereading",{data:{user_id:r.user.id,book_id:s.id,status:s.status},preserveScroll:!0,preserveState:!0})},d=async o=>{if(o.preventDefault(),s.has_review)await S.Inertia.patch(`/reviews/update/${s.review_id}`,{book_id:s.id,user_id:r.user.id,review:i,preserveScroll:!0,preserveState:!0,onSuccess:()=>{const t=window.location.href;history.replaceState(null,null,t)}}),c(!1);else try{await S.Inertia.post("/reviews/store",{book_id:s.id,user_id:r.user.id,review:i}),c(!1)}catch(t){console.error("Error al enviar la reseña:",t)}c(!1)},g=se("(max-width:600px)"),j=r.user.role=="user"?"#2C3E50":"#512E5F",b=r.user.role=="user"?"bg-metal":"bg-premium",_=s.portada?s.portada.startsWith("http")?s.portada:s.portada.replace(/^public\//,"/storage/"):null;return e.jsx("div",{className:"card w-full h-[280px] md:h-[250px] flex flex-col flex-1 pb-5 rounded min-w-[263px] border-b-2",children:e.jsxs("div",{className:"w-full max-h-[250px] flex flex-row items-center justify-start",children:[e.jsxs("div",{className:"w-full flex flex-row gap-10",children:[e.jsx("a",{href:route("books.show",s.id),className:"cursor-pointer",children:e.jsx("div",{className:"w-[140px] h-[215px]",children:s.portada?e.jsx("img",{src:_,alt:s.titulo,className:"w-full h-full rounded"}):e.jsx("div",{className:"w-[140px] h-[215px] bg-gray-300 flex items-center justify-center text-center rounded-lg",children:e.jsx("span",{className:"text-2xl font-bold text-gray-600",children:s.titulo})})})},s.id),e.jsxs("div",{className:"w-full max-h-[250px] flex flex-col justify-between",children:[e.jsxs("div",{className:" flex flex-col md:gap-2",children:[e.jsx("h2",{className:"titulo text-lg md:text-2xl font-serif",children:s.titulo}),e.jsxs("p",{className:"autor text-l",children:["by"," ",e.jsx("span",{className:"text-metal cursor-pointer underline italic",onClick:()=>S.Inertia.visit(`/books?autor=${s.autor}`),children:s.autor})]}),e.jsxs("p",{className:"serie text-sm md:text-lg",children:[s.serie||s.serie!==null?s.serie:"Libro Único"," ",s.num_serie?`#${s.num_serie}`:""]}),e.jsx(I,{book:s,initialRating:s.rate,readonly:s.status!=="leido"})]}),e.jsxs("div",{className:"max-h-[250px] flex flex-row items-end justify-between gap-2",children:[e.jsx("div",{className:"flex flex-row items-start justify-start",children:e.jsx(k,{initialStatus:s.status,book:s,auth:r,showPage:!1})}),e.jsxs("div",{className:"flex flex-col md:flex-row flex-wrap items-center justify-center gap-1 md:gap-5",children:[s.status==="leido"&&s.rate>0&&e.jsx("button",{className:"text-center transition duration-300 ease-in-out",onClick:()=>c(!0),title:"Escribir reseña",children:e.jsx(q,{sx:{fill:j,fontSize:g?"30px":"35px"}})}),e.jsx("button",{className:"text-center transition duration-300 ease-in-out",onClick:()=>f(!0),title:"Añadir a biblioteca",children:e.jsx(W,{sx:{fill:j,fontSize:g?"30px":"35px"}})}),e.jsx("button",{className:"text-center transition duration-300 ease-in-out",onClick:v,title:"Eliminar de la lista de lectura",children:e.jsx(z,{sx:{fill:Z[700],fontSize:g?"30px":"35px"}})})]})]})]})]}),h&&e.jsx(X,{book:s,librariesWithBookCount:N,setShowModal:f,auth:r}),p&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"w-full md:w-[30%] bg-white p-5 rounded-lg",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.has_review?"Este libro ya tiene una reseña, escribe otra para sobreescribirla":"Escribe aquí tu reseña"}),e.jsxs("form",{onSubmit:d,className:"flex flex-col gap-3",children:[e.jsx("textarea",{className:"w-full h-40 p-2 border rounded",value:i,onChange:o=>m(o.target.value),placeholder:s.has_review?"Este libro ya tiene una reseña, escribe otra para sobreescribirla":"Escribe aquí tu reseña"}),e.jsxs("div",{className:"w-full flex flex-row justify-around gap-5",children:[e.jsx("button",{type:"submit",className:`w-full ${b} text-white p-2 rounded`,children:"Publicar"}),e.jsx("button",{onClick:()=>c(!1),className:"w-full bg-red-500 text-white p-2 rounded",children:"Cancelar"})]})]})]})})]})})};function oe({value:s,onChange:r,role:N,want:h,reading:f,read:p}){const c=(g,j)=>{r(j)},i="#3f51b5",m="#000",v=i,d=i;return e.jsx("div",{className:"w-full items-center mb-5",children:e.jsx(te,{sx:{width:"100%",bgcolor:"background.paper"},children:e.jsxs(ae,{value:s,onChange:c,variant:"scrollable",scrollButtons:"auto",sx:{"& .MuiTabs-indicator":{backgroundColor:i},"& .MuiTab-root":{color:m,"&:hover":{color:d}},"& .Mui-selected":{color:v}},children:[e.jsx(R,{label:`Quiero Leer (${h})`}),e.jsx(R,{label:`Leyendo (${f})`}),e.jsx(R,{label:`Leido (${p})`}),e.jsx(R,{label:"Resumen Anual"})]})})})}function _e({auth:s,wantToReadBooks:r,readingBooks:N,readBooks:h,wantToReadBooksCount:f,readingBooksCount:p,readBooksCount:c,librariesWithBookCount:i}){const[m,v]=w.useState(()=>{const t=localStorage.getItem("selectedSectionReading");return t?parseInt(t):0}),[d,g]=w.useState(new Date().getFullYear());w.useEffect(()=>{localStorage.setItem("selectedSectionReading",m)},[m]);const j=t=>{v(t)},b=t=>{g(parseInt(t.target.value))},_=()=>{const t=h.filter(a=>a.readings.filter($=>new Date($.end_date).getFullYear()===d).length>0);if(console.log(t),t.length===0)return e.jsxs("div",{className:"w-full flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"w-[20%] flex flex-col items-center",children:[e.jsx("label",{htmlFor:"year-select",className:"text-lg text-gray-700",children:"Selecciona el Año:"}),e.jsx("select",{id:"year-select",value:d,onChange:b,className:"w-[50%] mt-2 p-2 border rounded",children:[...Array(10).keys()].map(a=>{const l=new Date().getFullYear()-a;return e.jsx("option",{value:l,children:l},l)})})]}),e.jsxs("p",{className:"text-lg text-gray-600",children:["No hay registros de lectura para el año ",d,"."]})]});const F=t.length,O=t.reduce((a,l)=>a+parseInt(l.paginas,10),0),x=t.reduce((a,l)=>parseInt(l.paginas,10)>parseInt(a.paginas,10)?l:a,t[0]||{}),u=t.reduce((a,l)=>parseInt(l.paginas,10)<parseInt(a.paginas,10)?l:a,t[0]||{}),y=t.filter(a=>a.rate!==null&&a.rate!==void 0&&a.rate!==""),T=y.reduce((a,l)=>a+parseFloat(l.rate),0)/y.length||0;var n={};y.length===0?n=null:y.length>0&&(n=t.reduce((a,l)=>parseFloat(l.rate)>parseFloat(a.rate)?l:a),console.log(n.rate));const V=t.reduce((a,l)=>{const H=l.readings.filter(C=>new Date(C.end_date).getFullYear()===d).reduce((C,D)=>{const Q=new Date(D.start_date),B=new Date(D.end_date),U=Math.abs(B-Q),G=Math.ceil(U/(1e3*60*60*24));return C+G},0);return a+H},0)/F||0,P=n.rate;return e.jsxs("div",{className:"w-full flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"w-full md:w-[20%] flex flex-col items-center",children:[e.jsx("label",{htmlFor:"year-select",className:"text-lg text-gray-700",children:"Selecciona el Año:"}),e.jsx("select",{id:"year-select",value:d,onChange:b,className:"w-[50%] mt-2 p-2 border rounded",children:[...Array(10).keys()].map(a=>{const l=new Date().getFullYear()-a;return e.jsx("option",{value:l,children:l},l)})})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"w-full flex flex-col items-center bg-white p-4 rounded shadow-md",children:[e.jsx("div",{className:"flex flex-row",children:e.jsxs("h3",{className:"text-xl font-semibold",children:["Has leído ",F," libros en ",d]})}),e.jsx("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-2",children:t.map(a=>e.jsx("div",{children:e.jsx(ee,{book:a})},a.id))})]}),e.jsxs("div",{className:"w-full mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:[e.jsxs("div",{className:"w-full flex flex-col items-center gap-4 bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Libro más largo"}),e.jsx("a",{href:route("books.show",x.id),className:"cursor-pointer",children:e.jsx("img",{src:`${x.portada}`,alt:"",className:"rounded w-[200px] h-[300px]"})},x.id),e.jsxs("p",{children:[(x==null?void 0:x.titulo)||"N/A"," (",(x==null?void 0:x.paginas)||0," páginas)"]})]}),e.jsxs("div",{className:"w-full flex flex-col items-center gap-4 bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Libro más corto"}),e.jsx("a",{href:route("books.show",u.id),className:"cursor-pointer",children:e.jsx("img",{src:`${u.portada}`,alt:"",className:"rounded w-[200px] h-[300px]"})},u.id),e.jsxs("p",{children:[(u==null?void 0:u.titulo)||"N/A"," (",(u==null?void 0:u.paginas)||0," páginas)"]})]}),e.jsx("div",{className:"w-full flex flex-col items-center gap-4 bg-white p-4 rounded shadow-md",children:n===null?e.jsx("div",{className:"w-full flex flex-col items-center justify-center gap-4 bg-white p-6 rounded",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-16 w-16 text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 2 l2 6 h6 l-5 4 2 6-5-4-5 4 2-6-5-4 h6 z"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-700 mt-4",children:"No hay libros puntuados"}),e.jsx("p",{className:"text-gray-500 mt-2 text-center",children:"¡Anímate a puntuar tus libros favoritos y ayudar a otros lectores! ¡Accede a tu página de libros leídos y puntúa!"})]})}):e.jsxs("div",{className:"text-center flex flex-col gap-4",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Libro más popular"}),e.jsx("a",{href:route("books.show",n.id),className:"cursor-pointer",children:e.jsx("img",{src:`${n.portada}`,alt:"",className:"rounded w-[200px] h-[300px]"})},n.id),e.jsxs("p",{className:"w-full flex flex-col items-center justify-center",children:[(n==null?void 0:n.titulo)||"N/A",e.jsx("p",{className:"w-full flex items-center justify-center",children:e.jsx(I,{initialRating:P,readonly:!0})})]})]})})]}),e.jsxs("div",{className:"w-full mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:[e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Total de páginas leídas"}),e.jsx("p",{className:"text-2xl",children:O})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Valoración Media"}),e.jsxs("p",{className:"text-2xl flex flex-row gap-4",children:[T.toFixed(2),e.jsx(I,{initialRating:T,size:"large",readonly:!0})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded shadow-md",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Tiempo Medio de Lectura por Libro"}),e.jsxs("p",{className:"text-2xl",children:[V.toFixed(2)," Días"]})]})]})]})]})},o=()=>{switch(m){case 0:return e.jsx("div",{className:"opacity-100 transition-opacity ease-in-out w-full flex flex-col gap-10",children:f>0?r.map(t=>e.jsx(M,{book:t,auth:s,librariesWithBookCount:i},t.id)):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-600",children:'No tienes libros en tu lista de "Quiero Leer".'}),e.jsx("a",{href:"/books",className:"text-blue-500 hover:underline",children:"Descubre libros"})]})},0);case 1:return e.jsx("div",{className:"opacity-100 transition-opacity ease-in-out w-full flex flex-col gap-10",children:p>0?N.map(t=>e.jsx(M,{book:t,auth:s,librariesWithBookCount:i},t.id)):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-600",children:'No tienes libros en tu lista de "Leyendo".'}),e.jsx("a",{href:"/books",className:"text-blue-500 hover:underline",children:"Descubre libros"})]})},1);case 2:return e.jsx("div",{className:"opacity-100 transition-opacity ease-in-out w-full flex flex-col gap-10",children:c>0?h.map(t=>e.jsx(M,{book:t,auth:s,librariesWithBookCount:i},t.id)):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-600",children:'No tienes libros en tu lista de "Leído".'}),e.jsx("a",{href:"/books",className:"text-blue-500 hover:underline",children:"Descubre libros"})]})},2);case 3:return _();default:return null}};return e.jsxs(K,{user:s.user,children:[e.jsx(J,{title:"Mis Lecturas"}),e.jsx("div",{className:"w-full h-full flex justify-center items-center",children:e.jsxs("div",{className:"mt-20 w-full max-w-6xl px-4",children:[e.jsx("div",{className:"flex",children:e.jsx(oe,{value:m,onChange:j,role:s.user.role,want:f,reading:p,read:c,summary:!0})}),o()]})})]})}export{_e as default};
